/*!
 * Repeatable list item 1.0 (http://nabeel.molham.me/plugins/repeatable.php)
 * Copyright 2014 Nabeel Molham.
 * Licensed under Apache 2.0 (http://www.apache.org/licenses/LICENSE-2.0.html)
 */
(function(e){jQuery(function(e){e.fn.repeatable_item=function(){var t={add_item:function(e,t,n,r){if(t.settings.is_empty){t.settings.is_empty=false;t.find(".repeatable-empty").remove()}var i=e.clone();var s=i.html().replace(/{index}/g,n);if(typeof r==="object"){for(var o in r){s=s.replace(new RegExp("{"+o+"}","g"),r[o])}}s=s.replace(/{.+}/g,"");i.html(s).appendTo(t);t.trigger("repeatable-new-item",[i,n,r])},array_keys:function(e,t,n){var r=typeof t!=="undefined",i=[],s=!!n,o=true,u="";if(e&&typeof e==="object"&&e.change_key_case){return e.keys(t,n)}for(u in e){if(e.hasOwnProperty(u)){o=true;if(r){if(s&&e[u]!==t){o=false}else if(e[u]!=t){o=false}}if(o){i[i.length]=u}}}return i},array_max:function(){var e,t,n=0,r=0,i=arguments,s=i.length,o=function(e){if(Object.prototype.toString.call(e)==="[object Array]"){return e}else{var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}};var u=function(e,t){var n=0,r=0,i=0,s=0,a=0;if(e===t){return 0}else if(typeof e==="object"){if(typeof t==="object"){e=o(e);t=o(t);a=e.length;s=t.length;if(s>a){return 1}else if(s<a){return-1}for(n=0,r=a;n<r;++n){i=u(e[n],t[n]);if(i==1){return 1}else if(i==-1){return-1}}return 0}return-1}else if(typeof t==="object"){return 1}else if(isNaN(t)&&!isNaN(e)){if(e===0){return 0}return e<0?1:-1}else if(isNaN(e)&&!isNaN(t)){if(t===0){return 0}return t>0?1:-1}if(t==e){return 0}return t>e?1:-1};if(s===0){throw new Error("At least one value should be passed to max()")}else if(s===1){if(typeof i[0]==="object"){e=o(i[0])}else{throw new Error("Wrong parameter count for max()")}if(e.length===0){throw new Error("Array must contain at least one element for max()")}}else{e=i}t=e[0];for(n=1,r=e.length;n<r;++n){if(u(t,e[n])==1){t=e[n]}}return t}};this.each(function(n,r){var i=e(r);i.trigger("repeatable-init");i.settings=e.extend({startIndex:0,addButtonLabel:"Add New",addButtonClass:"btn btn-primary",wrapperClass:"repeatable-wrapper",confirmRemoveMessage:"Are Your Sure ?",confirmRemove:"no",emptyListMessage:"No Items Found",values:[],is_empty:true},i.data());i.wrap('<div class="'+i.settings.wrapperClass+'" />');i.settings.startIndex=parseInt(i.settings.startIndex);i.item_template=i.find("li[data-template=yes]").removeAttr("data-template").remove();if(i.item_template.length!==1){throw"Repeatable Exception: Template item not found."}e('<a href="#" class="'+i.settings.addButtonClass+'">'+i.settings.addButtonLabel+"</a>").insertAfter(i).on("click",function(e){e.preventDefault();t.add_item(i.item_template,i,i.settings.startIndex);i.settings.startIndex++});if(i.settings.values.length){i.settings.is_empty=false;e.each(i.settings.values,function(e,n){t.add_item(i.item_template,i,e,n)});i.settings.startIndex=parseInt(t.array_max(t.array_keys(i.settings.values)))+1}else{if(i.settings.emptyListMessage!="no"){i.append('<li class="repeatable-empty">'+i.settings.emptyListMessage+"</li>")}}i.on("click","[data-remove=yes]",function(t){t.preventDefault();if(i.settings.confirmRemove=="yes"){if(!confirm(i.settings.confirmRemoveMessage)){return false}}var n=e(t.currentTarget).closest("li").remove();i.trigger("repeatable-removed",[n])});i.trigger("repeatable-completed",[i.settings])})}})})(window)